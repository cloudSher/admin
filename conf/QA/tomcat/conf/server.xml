<?xml version='1.0' encoding='utf-8'?>
<Server port="-1" shutdown="NO_SHUTDOWN">

    <Listener className="org.apache.catalina.core.AprLifecycleListener" SSLEngine="off"/>
    <Listener className="org.apache.catalina.core.JasperListener"/>
    <Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener"/>
    <Listener className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"/>

    <GlobalNamingResources>
        <Resource name="UserDatabase" auth="Container"
                  type="org.apache.catalina.UserDatabase"
                  description="User database that can be updated and saved"
                  factory="org.apache.catalina.users.MemoryUserDatabaseFactory"
                  pathname="conf/tomcat-users.xml"/>
    </GlobalNamingResources>

    <Service name="Catalina">

        <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"
                  maxThreads="500" minSpareThreads="20" maxIdleTime="60000"/>

        <!-- disable keepAlive, Nginx only support Http 1.0 -->
        <Connector port="8088" protocol="org.apache.coyote.http11.Http11AprProtocol"
                   executor="tomcatThreadPool"
                   connectionTimeout="10000" maxKeepAliveRequests="1"
                   redirectPort="-1"
                   acceptCount="100"
                   URIEncoding="UTF-8" useBodyEncodingForURI="true"/>


        <Engine name="Catalina" defaultHost="localhost">

            <!-- This Realm uses the UserDatabase configured in the global JNDI
                 resources under the key "UserDatabase".  Any edits
                 that are performed against this UserDatabase are immediately
                 available for use by the Realm.  -->
            <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
                   resourceName="UserDatabase"/>

            <Host name="localhost" appBase="webapps"
                  unpackWARs="true" autoDeploy="true">

                <Context path="/" docBase="/data/projects/s-workbench">
                    <Valve className="org.apache.catalina.valves.RemoteAddrValve"
                           allow="10\.\d+\.\d+\.\d+"/>
                    <Valve className="org.apache.catalina.valves.RemoteIpValve"
                           remoteIpHeader="X-Forwarded-For"
                           protocolHeader="X-Forwarded-Proto"/>
                    <Valve className="org.apache.catalina.valves.AccessLogValve"
                           prefix="access_log." suffix=".txt" fileDateFormat="yyyy-MM-dd"
                           pattern="%{X-Real-IP}i %S %I %{HH:mm:ss.SSS}t %r %s %b %D" resolveHosts="false" directory="/data/log/s-workbench"/>
                </Context>

            </Host>
        </Engine>
    </Service>
</Server>